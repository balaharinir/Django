
<html>
<head>
    
    <title>Book Details</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <marquee><h1>ADD BOOK DETAILS</h1></marquee>
        <a href="#" class="button" id="button">ADD BOOK</a>  
    </div>
    <div class="popup">
        <div class="popup-content">
            <form action="{% url 'add_books' %}" method="POST">
                <img src="{% static 'close.png' %}" class="close">
                <img src="{% static 'book.png' %}">
                {% csrf_token %}
                {{ form }}
                <button type="submit" id="button1" class="button1" onClick="openPopup()">SUBMIT</button>
            </form>
            <div class="popupopen" id="popupopen">
                <img src="{% static 'tick.jpg' %}" class="tick">
                <button class="closed" onClick="reset(); refresh()">OK</button>
                <h2>Submitted</h2>
                <p>Book has been updated successfully...</p>
            </div>  
        </div>
    </div>

    <div class="search-bar">
        <label for="searchtitle">Search by Book Title:</label>
        <input type="text" id="searchtitle" name="searchtitle" placeholder="Enter book name...">
        <button type="button" id="searchButton">Search</button>
    </div>
<div class="sort">
        <button type="button" id="ascButton" class="sortButton" value="asc">A->Z</button>
        <button type="button" id="descButton"class="sortButton" value="desc">Z->A</button>
    </div>
    <table class="table">
        <thead>
            <tr>
                <th>Book ID</th>
                <th>Title</th>
            </tr>
        </thead>
        <tbody id="tablebody">
            {% for book in books %}
                <tr>
                    <td>{{ book.1 }}</td>
                    <td>{{ book.2 }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>


    <script>
document.getElementById("button1").addEventListener("click", function(event) {
    event.preventDefault();
    const form = document.querySelector('form');
    const formData = new FormData(form);

    fetch(form.action, {
        method: form.method,
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        console.log(data);
        const tableBody = document.getElementById('tablebody');
        tableBody.innerHTML = '';
        data.books.forEach(book => {
            const newRow = document.createElement('tr');
            newRow.innerHTML = `<td>${book.book_id}</td><td>${book.title}</td>`;
            tableBody.appendChild(newRow);
        });
        openPopup();
    })
    .catch(error => {
        console.error('Error:', error);
    });
});



        $(document).ready(function() {
            $('#searchButton').click(function() {
                var searchtitle = $('#searchtitle').val();
		var sort = $('#ascButton').hasClass('active') ? 'asc' : ($('#descButton').hasClass('active') ? 'desc' : '');

                $.ajax({
                    url: '/get_books/',
                    type: 'GET',
                    data: {
                        'searchtitle': searchtitle,
			'sort' : sort
                    },
                    success: function(response) {
                        $('#tablebody').empty(); 
                        response.books.forEach(function(book) {
                            $('#tablebody').append(
                                '<tr>' +
                                    '<td>' + book.book_id + '</td>' +
                                    '<td>' + book.title + '</td>' +
                                '</tr>'
                            );
                        });
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            });

            $('#button').click(function() {
                $('.popup').css('display', 'flex');
            });

            $('.close').click(function() {
                $('.popup').css('display', 'none');
            });

            $('.closed').click(function() {
                $('.popupopen').css('display', 'none');
            });
	     $('.sortButton').click(function() {
                $('.sortButton').removeClass('active');
                $(this).addClass('active');
                $('#searchButton').click();
            });
        });
function openPopup() {
    document.querySelector(".popupopen").classList.add("active");   
}
function reset() {
            const form = document.querySelector('form');
            form.reset();
        }

        function refresh() {
            location.reload();
        }
    </script>
</body>
</html>
